<div class="dashboard-container">

  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1>üéØ Dashboard Distribu√≠do</h1>
      <button class="btn-logout" (click)="logout()">Sair</button>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Carregando dados de m√∫ltiplos bancos...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <p>‚ùå {{ error }}</p>
    <button class="btn-retry" (click)="loadDataDirectly()">Tentar Novamente</button>
  </div>

  <!-- Main Content - REMOVIDO O BLOQUEIO DO *ngIf -->
  <div class="dashboard-content" *ngIf="!loading">

    <!-- User Profile Card - PostgreSQL -->
    <section class="card profile-card" *ngIf="user">
      <div class="card-header postgres-header">
        <h2>üë§ Perfil do Usu√°rio</h2>
        <span class="db-badge postgres-badge">PostgreSQL</span>
      </div>
      <div class="card-body">
        <div class="profile-info">
          <div class="info-row">
            <span class="label">ID:</span>
            <span class="value">{{ user.userId }}</span>
          </div>
          <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{ user.email }}</span>
          </div>
          <div class="db-indicator" *ngIf="user.savedIn && user.savedIn.length > 0">
            <small>‚úÖ Dados armazenados em: {{ user.savedIn.join(', ') }}</small>
          </div>
        </div>
      </div>
    </section>

    <!-- Grid de 3 colunas -->
    <div class="cards-grid" *ngIf="user">

      <!-- MongoDB Card -->
      <section class="card mongo-card">
        <div class="card-header mongo-header">
          <h3>üìä Perfil Detalhado</h3>
          <span class="db-badge mongo-badge">MongoDB</span>
        </div>
        <div class="card-body">
          <div *ngIf="hasDataFrom('MongoDB')" class="data-content">
            <div class="stat-item">
              <span class="stat-label">Idade:</span>
              <span class="stat-value">{{ user.age || 'N/A' }} anos</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Pa√≠s:</span>
              <span class="stat-value">{{ user.country || 'N/A' }}</span>
            </div>
            <div class="genres-container" *ngIf="user.genres && user.genres.length > 0">
              <span class="stat-label">G√™neros favoritos:</span>
              <div class="genres-list">
                <span class="genre-tag" *ngFor="let genre of user.genres">{{ genre }}</span>
              </div>
            </div>
          </div>
          <div *ngIf="!hasDataFrom('MongoDB')" class="no-data">
            <p>‚ö†Ô∏è Dados n√£o dispon√≠veis no MongoDB</p>
          </div>
        </div>
      </section>

      <!-- Redis Card -->
      <section class="card redis-card">
        <div class="card-header redis-header">
          <h3>‚ö° Sess√µes</h3>
          <span class="db-badge redis-badge">Redis</span>
        </div>
        <div class="card-body">
          <div *ngIf="hasDataFrom('Redis')" class="data-content">
            <div class="login-counter">
              <div class="counter-value">{{ user.loginCount || 0 }}</div>
              <div class="counter-label">Total de Logins</div>
            </div>
          </div>
          <div *ngIf="!hasDataFrom('Redis')" class="no-data">
            <p>‚ö†Ô∏è Cache n√£o dispon√≠vel</p>
          </div>
        </div>
      </section>

      <!-- Neo4j Card -->
      <section class="card neo4j-card">
        <div class="card-header neo4j-header">
          <h3>üï∏Ô∏è Rede Social</h3>
          <span class="db-badge neo4j-badge">Neo4j</span>
        </div>
        <div class="card-body">
          <div *ngIf="network && network.nodes && network.nodes.length > 0" class="data-content">
            <div class="network-stats">
              <div class="stat-box">
                <div class="stat-number">{{ network.nodes.length - 1 }}</div>
                <div class="stat-text">Conex√µes</div>
              </div>
            </div>
            <div class="connections-list">
              <div *ngFor="let node of network.nodes" class="connection-item">
                <span class="connection-badge"
                      [style.background-color]="getNodeColor(node.group)">
                  {{ node.id }}
                </span>
                <span class="connection-type">{{ node.group === 'me' ? 'Voc√™' : 'Amigo' }}</span>
              </div>
            </div>
          </div>
          <div *ngIf="!network || !network.nodes || network.nodes.length === 0" class="no-data">
            <p>‚ö†Ô∏è Sem conex√µes no grafo</p>
          </div>
        </div>
      </section>

    </div>

    <!-- Logs Section - Full Width -->
    <section class="card logs-card">
      <div class="card-header logs-header">
        <h3>üìú Hist√≥rico de Atividades</h3>
        <span class="db-badge logs-badge">Sistema</span>
      </div>
      <div class="card-body">
        <div *ngIf="logs && logs.length > 0" class="logs-list">
          <div *ngFor="let log of logs" class="log-item">
            <span class="log-time">{{ formatTimestamp(log.timestamp) }}</span>
            <span class="log-action">{{ log.action }}</span>
            <span class="log-user" *ngIf="log.user">üë§ {{ log.user }}</span>
            <span class="log-system" *ngIf="log.system">‚öôÔ∏è {{ log.system }}</span>
          </div>
        </div>
        <div *ngIf="!logs || logs.length === 0" class="no-data">
          <p>üì≠ Nenhuma atividade registrada</p>
        </div>
      </div>
    </section>

  </div>
</div>
