<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container-fluid vh-100 d-flex flex-column overflow-hidden p-0">

  <header class="bg-dark text-white p-3 shadow z-3 d-flex justify-content-between align-items-center">
    <h4 class="m-0">ğŸ“ Dashboard DistribuÃ­do</h4>
    <div class="d-flex gap-2">
      <span class="badge bg-primary">Postgres (Auth)</span>
      <span class="badge bg-success">Mongo (Perfil)</span>
      <span class="badge bg-danger">Redis (Cache)</span>
      <span class="badge bg-warning text-dark">Neo4j (Grafo)</span>
    </div>
  </header>

  <div class="row flex-grow-1 g-0 overflow-hidden">

    <div class="col-md-3 bg-light border-end overflow-auto h-100 p-3">
      <h5 class="mb-3 text-secondary">UsuÃ¡rios ({{users.length}})</h5>

      <div *ngIf="isLoading" class="text-center mt-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p>Buscando dados nos 4 bancos...</p>
      </div>

      <div *ngFor="let user of users" class="card mb-3 shadow-sm user-card">

        <div class="card-header bg-primary text-white p-2">
          <div class="d-flex justify-content-between">
            <strong>ID: {{user.userId}}</strong>
            <small>PostgreSQL</small>
          </div>
          <small class="d-block text-truncate" style="opacity: 0.9">{{user.credentials?.email}}</small>
        </div>

        <div class="card-body p-2">

          <div class="p-2 mb-2 rounded border border-success bg-success bg-opacity-10">
            <h6 class="text-success m-0" style="font-size: 0.8rem">ğŸƒ MongoDB</h6>
            <div class="row g-0 mt-1" style="font-size: 0.8rem">
              <div class="col-6">PaÃ­s: <strong>{{user.profile?.country}}</strong></div>
              <div class="col-6">Idade: <strong>{{user.profile?.age}}</strong></div>
              <div class="col-12 text-truncate">Plano: {{user.profile?.subscriptionType}}</div>
            </div>
          </div>

          <div class="p-2 rounded border border-danger bg-danger bg-opacity-10 d-flex justify-content-between align-items-center">
            <span class="text-danger fw-bold" style="font-size: 0.8rem">ğŸ”´ Redis Logins</span>
            <span class="badge bg-danger rounded-pill">{{user.loginCount}}</span>
          </div>

        </div>

        <div class="card-footer bg-warning bg-opacity-25 p-1 text-center">
          <small class="text-dark" style="font-size: 0.75rem">
            ğŸŸ¡ Segue {{user.relations?.following?.length || 0}} pessoas
          </small>
        </div>
      </div>
    </div>

    <div class="col-md-9 position-relative bg-white">
      <div class="position-absolute top-0 start-0 m-3 z-1 bg-white p-2 rounded shadow opacity-75">
        <h6 class="m-0">ğŸ•¸ï¸ Rede Social (Neo4j)</h6>
        <small class="text-muted">As setas indicam quem segue quem.</small>
      </div>

      <div #networkGraph class="w-100 h-100"></div>
    </div>

  </div>
</div>
